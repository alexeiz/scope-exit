# Repository Guidelines

## Project Structure & Module Organization
- `include/scope_exit/scope_exit.hpp` — main, header‑only API and implementation.
- `include/scope_exit/detail/version.hpp.in` — template for generated version header.
- `test/` — Catch2 tests (`*.t.cpp`), configured via `test/CMakeLists.txt`.
- `cmake/` — presets, package config, install rules, and dependencies (CPM).
- `build/` — generated by CMake (Ninja); safe to delete/regenerate.
- `src/` — placeholder; no compiled sources (library remains header‑only).

## Build, Test, and Development Commands
- Configure (Debug): `cmake --preset=default`
- Build (Debug): `cmake --build --preset=default`
- Test: `ctest --preset=default`
- All‑in‑one: `cmake --workflow --preset=default`
- Release: `cmake --preset=release && cmake --build --preset=release`
- Run test binary directly: `./build/test/test_scope_exit`
- Install headers and CMake package: `cmake --install build`

## Coding Style & Naming Conventions
- C++17, 4‑space indentation, no tabs; keep lines readable (~100 cols).
- Make sure each source file ends with a new line.
- Warnings are errors (see `cmake/toolchain-gcc.cmake`); fix or silence intentionally.
- Files: lower_snake_case `.hpp`. Macros: `UPPER_SNAKE_CASE`. Namespaces: lower_snake_case with version suffix (e.g., `scope_exit_v1`).
- Types/functions/variables follow current style (e.g., `scope_guard`, `scope_guard_tag`). Avoid introducing dynamic allocation or new runtime deps.

## Testing Guidelines
- Framework: Catch2 v3 (fetched via CPM).
- Add tests under `test/` with `*.t.cpp`; use Catch2 tags where helpful.
- New test executables: extend `test/CMakeLists.txt` via `make_test(name files...)`.
- Ensure all tests pass on both `default` and `release` presets.

## Commit & Pull Request Guidelines
- Commits: short, imperative, present tense (e.g., "add unit tests", "remove unnecessary includes").
- PRs: clear description, rationale, linked issues; include tests for new/changed behavior.
- Before review, run: `cmake --workflow --preset=default` and `ctest --preset=release`.

## Security & Configuration Tips
- Presets use Ninja and a GCC toolchain with strict warnings; prefer the provided presets.
- Do not change public macro names or the `scope(exit)` contract without a version bump.

## Agent‑Specific Instructions
- Respect this AGENTS.md across the repo; keep changes minimal and focused.
- Match existing style; do not introduce new dependencies or modify unrelated files.
- The library is header‑only; edits to `include/` are shipped as‑is on install.
